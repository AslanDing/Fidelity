import os
os.environ['CUDA_VISIBLE_DEVICES'] = '1'
import torch
print(torch.cuda.is_available())
from ExplanationEvaluation.configs.selector import Selector
from ExplanationEvaluation.tasks.replication import replication,replication_sp

import nni
from nni.utils import merge_parameter

_dataset = 'ba2motifs'      # One of: bashapes, bacommunity, treecycles, treegrids, ba2motifs, mutag
_explainer = 'pgexplainer' # One of: pgexplainer, gnnexplainer

# Parameters below should only be changed if you want to run any of the experiments in the supplementary
_folder = 'replication' # One of: replication, extension

# PGExplainer
config_path = f"./ExplanationEvaluation/configs/{_folder}/explainers/{_explainer}/{_dataset}.json"
print(config_path)
config = Selector(config_path)

nni_params = nni.get_next_parameter()
config.args.explainer = merge_parameter(config.args.explainer, nni_params)


extension = (_folder == 'extension')

# config.args.explainer.seeds = [0]

(auc, auc_std), inf_time = replication_sp(config.args.explainer, extension,run_qual=False,results_store=False,extend=True)

print((auc, auc_std), inf_time)

nni.report_final_result(auc)

"""
ba-motifs
fid plus  [0.18315058 0.18566243 0.18576052 0.1896967  0.19628504 0.20198741
 0.20173295 0.20281864 0.1793028  0.13199205 0.20196588] [1.38609165e-02 8.83643469e-03 6.97261730e-03 7.28541894e-03
 8.91371302e-03 9.30319739e-03 9.15726081e-03 1.15077234e-02
 9.48724620e-03 1.96781132e-02 4.96772175e-09]
fid minus  [ 0.19099969  0.18813988  0.18788688  0.19040978  0.19068762  0.18107663
  0.17061369  0.15367659  0.14095611  0.1634461  -0.23347045] [1.69103670e-02 1.45856449e-02 1.42779043e-02 1.28670660e-02
 1.45320309e-02 9.45643508e-03 6.09993590e-03 1.05033645e-02
 1.58618174e-02 1.27695471e-02 1.41929864e-08]
fid label plus  [0.447  0.4555 0.463  0.4755 0.4855 0.4905 0.4795 0.4775 0.4465 0.383
 0.48  ] [4.36577599e-02 2.76992780e-02 2.51197134e-02 2.96184064e-02
 2.77893865e-02 2.26329406e-02 1.98053023e-02 1.56923548e-02
 1.68893458e-02 3.31813200e-02 1.11022302e-16]
fid label minus  [ 0.491   0.4905  0.476   0.466   0.4605  0.452   0.4275  0.4075  0.407
  0.3545 -0.01  ] [4.34050688e-02 4.17402683e-02 3.53411941e-02 3.32264955e-02
 4.68748333e-02 2.63818119e-02 2.27211355e-02 2.15928229e-02
 3.11608729e-02 2.49449394e-02 1.73472348e-18]
sparse  [0.5        0.53928589 0.59800643 0.63750065 0.69622116 0.74485
 0.79443592 0.84285643 0.89265062 0.94107116 0.78470129] [0.00000000e+00 1.11022302e-16 0.00000000e+00 1.11022302e-16
 1.11022302e-16 0.00000000e+00 1.11022302e-16 0.00000000e+00
 1.11022302e-16 0.00000000e+00 1.11022302e-16]
(0.6279995486160981, 0.007047516391613679) 325.9827578186989
"""

"""
ba-shape
fid plus  [0.24812403 0.24812403 0.24812403 0.24780354 0.24775325 0.24775325
 0.2481614  0.248144   0.24956888 0.25531758 0.28985641] [1.24901186e-03 1.24901291e-03 1.24901262e-03 9.43063892e-04
 9.56044285e-04 9.56045666e-04 2.09606921e-03 2.12666503e-03
 3.30158048e-03 6.56277652e-03 1.17628233e-08]
fid minus  [0.2590258  0.26631351 0.27420016 0.28224292 0.29491314 0.31239416
 0.33814151 0.34512164 0.3239536  0.28639056 0.24977046] [9.39135308e-03 9.92995556e-03 7.97225717e-03 8.42649529e-03
 9.32515290e-03 7.74601803e-03 1.55110822e-02 1.48411465e-02
 8.28348627e-03 1.18740060e-02 7.88010199e-09]
fid label plus  [-0.01666667 -0.01666667 -0.01666667 -0.01666667 -0.01666667 -0.01666667
 -0.015      -0.015      -0.01166667  0.00166667  0.01666667] [0.         0.         0.         0.         0.         0.
 0.005      0.005      0.00763763 0.0157233  0.        ]
fid label minus  [ 0.09166667  0.10333333  0.12        0.16333333  0.21166667  0.25
  0.29666667  0.325       0.29833333  0.25166667 -0.01666667] [0.03270236 0.03636237 0.03858612 0.04396969 0.04775516 0.02981424
 0.05467073 0.04166667 0.04374802 0.04179979 0.        ]
sparse  [0.5        0.54917458 0.59925298 0.64909949 0.69915201 0.74962115
 0.79925617 0.84926007 0.8991552  0.94918499 0.988657  ] [0.00000000e+00 0.00000000e+00 1.11022302e-16 0.00000000e+00
 1.11022302e-16 4.61250544e-06 1.11022302e-16 0.00000000e+00
 0.00000000e+00 1.11022302e-16 0.00000000e+00]
(0.8844281082058701, 0.002043808918475197) 66.22328531742096

"""
